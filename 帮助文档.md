# 帮助文档





## IO-HTTP

### 1.总体介绍

![IO-HTTP.png](E:\java_code\leetcode-runner\帮助文档.assets\IO-HTTP.png)

使用apache的httpclient框架作为底层请求支持，在此基础上根据lc-runner业务进行封装



总体来说分为两层，第一层HttpClient，封装httpclient提供的基础能力，对外暴露发送get和post请求方法，此外支持cookie的相关操作



第二层是LeetcodeClient，封装HttpClient提供能力，对业务提供各种业务接口，诸如`登录判断`，`题目获取`,`代码提交`等功能，该模块直接对接`service`模块



另外，针对http的请求和响应，项目也做了一定封装——`HttpRequest`，`HttpResponse`



### 2.细节描述

leetcode接口采用graphql技术，按需分配资源，关于该技术的详细介绍，可自行搜索



关于该技术对于本项目的影响，体现在Request Body的构建上



在没运用graphql技术前，不同资源是按照url请求路径区分，但应用该技术后，对于国内leetcode来说，大部分资源请求url都是**https://leetcode.cn/graphql**，而区分资源是依赖请求体



以**题目内容查询、用户状态查询**接口为例

> 题目内容查询
>
> url = https://leetcode.cn/graphql
>
> body = 
>
> ```json
> {
>     "query": "\n    query problemsetQuestionList($categorySlug: String, $limit: Int, $skip: Int, $filters: QuestionListFilterInput) {\n  problemsetQuestionList(\n    categorySlug: $categorySlug\n    limit: $limit\n    skip: $skip\n    filters: $filters\n  ) {\n    hasMore\n    total\n    questions {\n      acRate\n      difficulty\n      freqBar\n      frontendQuestionId\n      isFavor\n      paidOnly\n      solutionNum\n      status\n      title\n      titleCn\n      titleSlug\n      topicTags {\n        name\n        nameTranslated\n        id\n        slug\n      }\n      extra {\n        hasVideoSolution\n        topCompanyTags {\n          imgUrl\n          slug\n          numSubscribed\n        }\n      }\n    }\n  }\n}\n    ",
>     "variables": {
>         "categorySlug": "all-code-essentials",
>         "skip": 0,
>         "limit": 1,
>         "filters": {
>             "searchKeywords": "3254"
>         }
>     },
>     "operationName": "problemsetQuestionList"
> }
> ```



> 用户状态查询
>
> url = https://leetcode.cn/graphql
>
> body = 
>
> ```json
> {
>     "query": "\n    query globalData {\n  userStatus {\n    isSignedIn\n    isPremium\n    username\n    realName\n    avatar\n    userSlug\n    isAdmin\n    useTranslation\n    premiumExpiredAt\n    isTranslator\n    isSuperuser\n    isPhoneVerified\n    isVerified\n  }\n  jobsMyCompany {\n    nameSlug\n  }\n  commonNojPermissionTypes\n}\n    ",
>     "variables": {}
> }
> ```



通过上述两个demo可以发现，运用了graphql技术的接口，请求体的构建相对麻烦



基于此，封装如下三个类，帮助创建请求体

![image-20241121160456814](E:\java_code\leetcode-runner\帮助文档.assets\image-20241121160456814.png)



- GraphqlReqBody，负责构建请求体
- SearchParams，是GraphqlReqBody的内部类，负责构建variables变量
- ParamsBuilder，是SearchParams的内部类，通过建造者模式辅助构建SearchParams



### 3. 使用Demo

```java
// 辅助构建varablies
GraphqlReqBody.SearchParams params = new GraphqlReqBody.SearchParams.ParamsBuilder()
    .setCategorySlug("all-code-essentials")
    .setLimit(limit)
    .setSkip(skip)
    .build();
// 构建graphql请求体
GraphqlReqBody body = new GraphqlReqBody(LeetcodeApiUtils.PROBLEM_SET_QUERY);
body.setBySearchParams(params);
// 构建httpRequest
HttpRequest httpRequest = new HttpRequest.RequestBuilder(url)
    .setBody(body.toJsonStr())
    .setContentType("application/json")
    .addBasicHeader()
    .build();
// send request
HttpResponse httpResponse = httpClient.executePost(httpRequest);
String resp = httpResponse.getBody();
```

